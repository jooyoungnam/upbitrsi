<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>RSI Dashboard</title>
  <script>
    let isLoading = false;
    let countdown = 60;
    let countdownInterval;
    const displayedRSI = new Set();

    function getRSIColor(rsi) {
      if (rsi >= 70) return 'darkred';
      if (rsi >= 60) return 'red';
      if (rsi >= 50) return 'indianred';
      if (rsi >= 40) return 'green';
      if (rsi >= 30) return 'lightblue';
      return 'blue';
    }

    async function fetchAndDisplayRSI() {
      isLoading = true;

      const response = await fetch(`https://port-0-upbitrsi-2rrqq2blmm4tos2.sel5.cloudtype.app/rsi`);
      const { rsiData } = await response.json();

      let content = '';
      for (const [market, data] of Object.entries(rsiData)) {
        const { rsi, korean_name } = data;

        if (!displayedRSI.has(market)) {
          const color = getRSIColor(rsi);
          content += `<div style="color: ${color}">${korean_name} (${market}) - RSI: ${rsi.toFixed(2)}</div>`;
          displayedRSI.add(market);
        }
      }

      const rsiDisplay = document.getElementById('rsiDisplay');
      rsiDisplay.innerHTML = content + rsiDisplay.innerHTML;  // 변경된 부분

      isLoading = false;
    }

    function displayCountdown() {
      const countdownDisplay = document.getElementById('countdownDisplay');
      countdownDisplay.innerText = `${countdown}초`;
      countdown--;

      if (countdown >= 0) {
        countdownInterval = setTimeout(displayCountdown, 1000);
      } else {
        fetchAndDisplayRSI();
        countdown = 60;
        countdownDisplay.innerText = `${countdown}초`;
      }
    }

    window.onload = function() {
      const titleElement = document.getElementById('title');
      titleElement.innerHTML += ' (<span id="countdownDisplay">60초</span>)';  // 변경된 부분

      fetchAndDisplayRSI();
      countdownInterval = setTimeout(displayCountdown, 1000);
      setInterval(() => {
        if (!isLoading) {
          fetchAndDisplayRSI();
        }
      }, 60000);
    };
  </script>
</head>
<body style="background-color: black;">
  <h1 id="title" style="color: white;">Upbit KRW Coins RSI</h1> <!-- 변경된 부분 -->
  <div id="rsiDisplay"></div>
</body>
</html>
